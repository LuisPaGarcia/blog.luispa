---
slug: how-to-cache-node_modules-on-github-actions
title: How to cache node_modules on Github Actions
date: 2021-09-30
author: luispa
tags:
  - document
---
## tl;dr
- Github will charge you by execution time, so apply this feature will reduce your invoice.
- This post shows 2 ways to cache the `node_modules` during a Github Action execution.
- The benefits of ovoid the `npm ci` step can speed up the action execution.

Most of the Github Actions I've created are Node.js apps, so the `npm install` is always part of the requirements. I found 2 ways to reduce the execution time by using the `actions/cache@v2` [cache action](https://github.com/actions/cache/). 

1. Cache npm things when using `npm ci`

We can win time by using `npm ci` with a resolved dependency tree, by caching the `package-lock.json` context.


```yaml
- name: Cache dependencies
  uses: actions/cache@v2
  with:
    path: ~/.npm
    key: npm-${{ hashFiles('package-lock.json') }}
    restore-keys: npm-
```

By caching the dependencies, this cached version will be used instead of downloading them. The dependencies will be downloaded only when the package-lock.json changes. 

```yaml
name: CI

on: main


jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '12'



      - name: Cache dependencies
        uses: actions/cache@v2
        with:
          path: ~/.npm
          key: npm-${{ hashFiles('package-lock.json') }}
          restore-keys: npm-


      - name: Install dependencies
        run: npm ci


      # ... here all the things related to the job, like a test script, lint or deploy
```

2. Cache the node_modules (faster)

This is faster because we ovoid the `npm ci` entire action.

```yaml
- name: Cache dependencies
  id: cache
  uses: actions/cache@v2
  with:
    path: ./node_modules
    key: modules-${{ hashFiles('package-lock.json') }}



- name: Install dependencies
  if: steps.cache.outputs.cache-hit != 'true'
  run: npm ci
```

So this is the example of the Github Actions using cache.

```yaml
name: CI

on: main


jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2


      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '12'


      - name: Cache dependencies
        id: cache
        uses: actions/cache@v2
        with:
          path: ./node_modules
          key: modules-${{ hashFiles('package-lock.json') }}


      - name: Install dependencies
        if: steps.cache.outputs.cache-hit != 'true'
        run: npm ci


      # ... here all the things related to the job, like test script, lint or deploy
```

## Wrap up

The first solution is a better approach for most of the projects. The second one is faster (by far), I choose the second one. 

The cache will last 7 days in Github, just keep that in mind.

Now you have 2 approaches to reduce the time of your Github Actions.

So, let's reduce your Github invoice right now :D.

Happy coding!

